#!/usr/bin/env bash
# Neovim plugin Node.js wrapper
# Forces Node 22+ for Copilot, ignoring project-specific .nvmrc files
# This prevents conflicts when working in legacy projects with older Node versions

set -e  # Exit on error

# Load NVM with absolute path
export NVM_DIR="$HOME/.nvm"
if [ -s "$NVM_DIR/nvm.sh" ]; then
  \. "$NVM_DIR/nvm.sh"
else
  # If NVM not found, try to find node directly
  NODE_PATH=$(which node 2>/dev/null)
  if [ -n "$NODE_PATH" ]; then
    exec "$NODE_PATH" "$@"
  fi
  echo "Error: Neither NVM nor Node.js found" >&2
  exit 1
fi

# Use Node 22 regardless of project .nvmrc
nvm use 22 >/dev/null 2>&1 || {
  # If Node 22 not available, use default
  nvm use default >/dev/null 2>&1 || true
}

# Execute Node with provided arguments
exec node "$@"

